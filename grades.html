<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Grades — Mini LMS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="common.css" />
</head>
<body>
  <div class="container">
    <div class="header card">
      <div class="logo"><div class="box">LMS</div><div><div style="font-weight:800">Grades</div><div class="small muted">Gradebook</div></div></div>
      <div><a href="dashboard.html" class="btn ghost">← Dashboard</a></div>
    </div>

    <div class="card">
      <h3>Grades</h3>
      <div id="gradeArea"></div>
    </div>
  </div>

<script>
const DB = {
  get(k,d=null){ try{ return JSON.parse(localStorage.getItem(k)) ?? d }catch(e){ return d }},
  set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }, push(k,v){ const a=DB.get(k,[]); a.push(v); DB.set(k,a) }
};
if (!DB.get('grades')) DB.set('grades',[]);
const me = DB.get('currentUser'); if (!me) { alert('Not signed in'); location.href='index.html' }
const gradeArea = document.getElementById('gradeArea');

function render(){
  gradeArea.innerHTML = '';
  const assignments = DB.get('assignments',[]);
  if (me.role === 'student'){
    const grades = DB.get('grades',[]).filter(g=>g.email===me.email);
    if (!grades.length) gradeArea.innerHTML = '<div class="small muted">No grades yet</div>';
    else grades.forEach(g=>{
      const a = assignments.find(x=>x.id===g.assgId);
      gradeArea.innerHTML += `<div class="list"><div class="item"><div style="flex:1"><div style="font-weight:800">${a? a.title : 'Assignment '+g.assgId}</div><div class="small muted">${g.marks} / ${g.total} • ${a? a.subject : ''}</div></div></div></div>`;
    });
  } else if (me.role === 'faculty'){
    gradeArea.innerHTML = '<div class="small muted">Select a student and enter marks</div>';
    // tool: list assignments by this faculty and allow entering grade for specific student
    const myA = assignments.filter(a=>a.faculty===me.email);
    myA.forEach(a=>{
      const div=document.createElement('div'); div.className='card'; div.style.marginTop='8px';
      div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${a.title}</strong><div class="small muted">${a.subject}</div></div><div><input placeholder="student email" class="input" id="st-${a.id}" style="width:180px"/><input placeholder="marks" id="marks-${a.id}" class="input" style="width:100px;margin-left:8px"/><button class="btn" data-id="${a.id}" style="margin-left:8px">Save</button></div></div>`;
      gradeArea.appendChild(div);
      div.querySelector('button')?.addEventListener('click', (ev)=>{
        const id = Number(ev.currentTarget.getAttribute('data-id'));
        const email = document.getElementById('st-'+id).value.trim().toLowerCase();
        const marks = document.getElementById('marks-'+id).value.trim();
        if (!email || !marks) return alert('student email and marks required');
        DB.push('grades', { assgId:id, email, marks:Number(marks), total:100 });
        alert('Saved grade');
      });
    });
  } else {
    gradeArea.innerHTML = '<div class="small muted">Admins can view grades indirectly.</div>';
  }
}
render();
</script>
</body>
</html>
